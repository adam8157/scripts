#!/bin/bash

for args in "$@"
do
	fname=$(readlink -f "$args")
	bname=$(basename "$fname")
	dname=$(dirname "$fname")
	dest1st=${bname%.*}
	dest2nd=${dest1st%.*}
	destdir=${dest1st}

	case "$bname" in
		*.tar.gz | *.tar.bz2 | *.tar.xz | *.tar.7z)
			destdir=${dest2nd};;
	esac

	if [ ! -w "$dname" ]
	then
		echo Permission denied.
		exit 1
	elif [ -d "$dname/$destdir" ]
	then
		echo Directory already exists.
		exit 1
	else
		cd "$dname"
		mkdir "$destdir"
		cd "$destdir"

		case "$bname" in
			*.tar.bz2 | *.tbz | *.tb2 | *.tbz2)
				tar xvjf "$fname";;
			*.tar.7z | *.t7z)
				7z x -so "$fname" | tar xf -;;
			*.tar.gz | *.tgz)
				tar xvzf "$fname";;
			*.tar.xz | *.txz)
				tar xvJf "$fname";;
			*)
				7z x "$fname";;
		esac
	fi

	cd "$dname"
done

exit 0
